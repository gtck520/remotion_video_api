# Remotion è§†é¢‘ç”ŸæˆæœåŠ¡ (Video Generation Service)

åŸºäº **Remotion**ã€**Express** å’Œ **React Three Fiber** æ„å»ºçš„é«˜æ€§èƒ½è§†é¢‘ç”Ÿæˆ APIã€‚ä¸“ä¸º **n8n** è‡ªåŠ¨åŒ–å·¥ä½œæµå’Œ **AI Agent (MCP)** é›†æˆè€Œè®¾è®¡ï¼Œæ”¯æŒ 2D/3D æ··åˆæ¸²æŸ“ã€ç‰©ç†æ¨¡æ‹Ÿå’Œæ™ºèƒ½æ’ç‰ˆã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

- **ğŸ¤– AI å‹å¥½å‹ Schema**: ä¸“ä¸º LLM è®¾è®¡çš„ `SmartExplainer` ç»„ä»¶ï¼Œåªéœ€æä¾›æ–‡æœ¬å³å¯ç”Ÿæˆä¸“ä¸šæ¼”ç¤ºè§†é¢‘ã€‚
- **ğŸ§Š 3D & ç‰©ç†å¼•æ“**: é›†æˆ `React Three Fiber` å’Œ `Matter.js`ï¼Œæ”¯æŒ 3D äº§å“å±•ç¤ºã€é‡åŠ›æ‰è½å’Œç²’å­æµä½“æ•ˆæœã€‚
- **ğŸ”Œ MCP åŸç”Ÿæ”¯æŒ**: å®ç° Model Context Protocol (SSE)ï¼Œå…è®¸ Claude/Cursor ç›´æ¥è°ƒç”¨æ¸²æŸ“èƒ½åŠ›ã€‚
- **âš¡ é«˜æ€§èƒ½æ¶æ„**: åŸºäº Bun è¿è¡Œæ—¶ï¼Œå†…ç½®å¹¶å‘æ§åˆ¶å’Œæ¸²æŸ“é˜Ÿåˆ—ï¼Œæ”¯æŒ Docker éƒ¨ç½²ã€‚
- **ğŸ§© æ¨¡å—åŒ–åœºæ™¯**: æ‹¥æœ‰ `MasterSequence` ä¸»æ§æ¨¡ç‰ˆï¼Œæ”¯æŒ 15+ ç§åŸå­åœºæ™¯è‡ªç”±ç»„åˆã€‚
- **ğŸ—£ï¸ å¤šè¯­è¨€ TTS**: é›†æˆ Microsoft Edge TTSï¼Œé»˜è®¤æ”¯æŒä¸­æ–‡ (`zh-CN-XiaoxiaoNeural`) åŠå…¨çƒå¤šç§è¯­éŸ³ã€‚

---

## ğŸ“… æœ€æ–°æ›´æ–° (2026-01-20)

### 1. ğŸ“± è‡ªå®šä¹‰è§†é¢‘å°ºå¯¸
æ”¯æŒåœ¨ç”Ÿæˆæ—¶æŒ‡å®šè§†é¢‘å®½é«˜ï¼Œå®Œç¾é€‚é…ä¸åŒå¹³å°ï¼š
- **æ‰‹æœºç«–å± (Shorts/TikTok/Reels)**: è®¾ç½® `width: 1080`, `height: 1920`
- **ç”µè„‘æ¨ªå± (YouTube/Bilibili)**: è®¾ç½® `width: 1920`, `height: 1080` (é»˜è®¤)

### 2. ğŸ¨ å­—å¹•æ ·å¼å®šåˆ¶
å‘Šåˆ«å•ä¸€å­—å¹•ï¼Œæ–°å¢å¤šç§é¢„è®¾é£æ ¼ï¼š
- **`neon`**: èµ›åšæœ‹å…‹éœ“è™¹å‘å…‰é£æ ¼ã€‚
- **`comic`**: è¶£å‘³æ¼«ç”»é£æ ¼ (é»„è‰²é»‘è¾¹)ã€‚
- **`clean`**: æç®€æ— èƒŒæ™¯é£æ ¼ã€‚
- **`default`**: æ ‡å‡†é»‘åº•ç™½å­—ã€‚
åŒæ—¶ä¹Ÿæ”¯æŒé€šè¿‡ `style` å’Œ `textStyle` è¿›è¡Œå®Œå…¨è‡ªå®šä¹‰ã€‚

### 3. æ–°å¢ "Cool" è§†è§‰ç»„ä»¶
ä¸ºäº†æ‘†è„±å•è°ƒçš„ PPT é£æ ¼ï¼Œæˆ‘ä»¬å¼•å…¥äº†é«˜è§†è§‰å†²å‡»åŠ›çš„æ¨¡ç‰ˆï¼š
- **`CyberIntro` (èµ›åšå¼€åœº)**: å¸¦æœ‰æ•…éšœè‰ºæœ¯æ•ˆæœ (Glitch) çš„ç§‘æŠ€æ„Ÿå¼€åœºã€‚
- **`PhysicsStack` (ç‰©ç†å †å )**: ä½¿ç”¨ç‰©ç†å¼•æ“æ¨¡æ‹Ÿç‰©ä½“æ‰è½ï¼Œæ¯”æ™®é€šåˆ—è¡¨æ›´ç”ŸåŠ¨ã€‚
- **`TechCode` (ä»£ç æ¼”ç¤º)**: çœŸå®çš„æ‰“å­—æœºæ•ˆæœï¼Œæ”¯æŒè¯­æ³•é«˜äº®ï¼Œé€‚åˆå±•ç¤ºä»£ç ç‰‡æ®µã€‚
- **`ThreeDText` (3D æ–‡å­—)**: å…·æœ‰çœŸå®å…‰å½±çš„æ‚¬æµ® 3D æ–‡æœ¬ (å·²ä¼˜åŒ–ï¼šç§»é™¤å¤–éƒ¨ HDR ä¾èµ–ï¼Œæå‡ç¨³å®šæ€§)ã€‚

### 4. SmartExplainer å¢å¼º
- **å¸ƒå±€å‡çº§**: å®Œç¾æ”¯æŒ `SplitImage` (å·¦æ–‡å³å›¾) å’Œ `BulletList` (è¦ç‚¹åˆ—è¡¨) å¸ƒå±€ã€‚
- **ç¨³å¥æ€§æå‡**: å¢åŠ äº†å®Œå–„çš„é»˜è®¤å€¼å¤„ç†ï¼Œé˜²æ­¢å›  LLM æ¼ä¼ å‚æ•°å¯¼è‡´çš„æ¸²æŸ“å¤±è´¥ã€‚
- **ä¸­æ–‡ä¼˜åŒ–**: é»˜è®¤ä¸­æ–‡å­—ä½“å’Œæ’ç‰ˆä¼˜åŒ–ã€‚

### 5. ğŸ§  æ™ºèƒ½å›¾åƒç”Ÿæˆ (AI Image Generation)
å½“ Pexels æ— æ³•æ‰¾åˆ°åˆé€‚çš„åª’ä½“ç´ æï¼Œæˆ–è€…æ‚¨å¸Œæœ›åˆ›é€ è¶…ç°å®çš„è§†è§‰æ•ˆæœæ—¶ï¼Œç³»ç»Ÿæ”¯æŒ AI å›¾åƒç”Ÿæˆã€‚
- **å½“å‰æ”¯æŒæ¨¡å‹**: 
  - Coze Workflow (`coze`, é»˜è®¤, æ¨è)
  - æ™ºè°± GLM-Image (`glm-image`, å¤‡ç”¨)
- **è§¦å‘æ–¹å¼**: åœ¨åœºæ™¯å±æ€§ä¸­è®¾ç½® `aiImage: true`ã€‚é»˜è®¤ä½¿ç”¨ Cozeï¼Œå¦‚éœ€æŒ‡å®šå¯è®¾ç½® `imageModel: "coze"` æˆ– `"glm-image"`ã€‚
- **è‡ªåŠ¨å›é€€**: Pexels æœç´¢å¤±è´¥ -> AI ç”Ÿæˆ (é»˜è®¤ Coze -> å›é€€ GLM) -> çº¯æ–‡æœ¬åŠ¨ç”» (KineticText)ã€‚
- **é…ç½®**: 
  - Coze: éœ€è¦åœ¨ `.env` ä¸­è®¾ç½® `COZE_API_TOKEN`, `COZE_WORKFLOW_ID`ã€‚
    - **æ³¨æ„**: å¦‚æœæ‚¨çš„ Coze Workflow éœ€è¦ç‰¹å®šçš„ç”¨æˆ·ä¸Šä¸‹æ–‡ï¼Œè¯·åŠ¡å¿…è®¾ç½® `COZE_USER_TOKEN` (é»˜è®¤æ¨èè®¾ç½®)ã€‚
  - GLM: éœ€è¦åœ¨ `.env` ä¸­è®¾ç½® `ZHIPU_API_KEY`ã€‚

### 6. ğŸ›¡ï¸ ç¨³å¥çš„å…œåº•æœºåˆ¶ (Robust Fallback)
ä¸ºäº†ç¡®ä¿ n8n è‡ªåŠ¨åŒ–æµç¨‹æ°¸ä¸ä¸­æ–­ï¼Œæˆ‘ä»¬å¼•å…¥äº†å¤šçº§é™çº§ç­–ç•¥ï¼š
1. **ä¼˜å…ˆ**: ä½¿ç”¨ç”¨æˆ·æä¾›çš„ `imageUrl` / `videoUrl`ã€‚
2. **æ¬¡é€‰**: ä½¿ç”¨ `imageQuery` åœ¨ Pexels æœç´¢è§†é¢‘/å›¾ç‰‡ã€‚
3. **AI è¡¥å……**: å¦‚æœå¼€å¯ AI ä¸” Pexels å¤±è´¥ï¼Œå°è¯• Coze (é»˜è®¤) æˆ– GLM-4 ç”Ÿæˆå›¾ç‰‡ã€‚
4. **æœ€ç»ˆå…œåº•**: å¦‚æœä»¥ä¸Šå…¨å¤±è´¥ï¼Œè‡ªåŠ¨å°†åœºæ™¯é™çº§ä¸º **KineticText** (åŠ¨æ€æ–‡å­—)ï¼Œç¡®ä¿è§†é¢‘èƒ½å¤Ÿç”Ÿæˆï¼Œç»ä¸æŠ¥é”™é€€å‡ºã€‚

### 7. ğŸµ äº‘ç«¯èƒŒæ™¯éŸ³ä¹åº“ (WebDAV BGM)
æ”¯æŒé€šè¿‡ WebDAV åè®®æŒ‚è½½äº‘ç«¯éŸ³ä¹åº“ï¼Œå®ç°â€œäº‘ç«¯ç®¡ç†ï¼Œæœ¬åœ°é«˜é€Ÿæ¸²æŸ“â€ã€‚
- **åˆ†ç±»ç®¡ç†**: åœ¨ WebDAV æ ¹ç›®å½•ä¸‹æŒ‰é£æ ¼å»ºç«‹æ–‡ä»¶å¤¹ï¼ˆå¦‚ `/Music/Tech`, `/Music/Cinematic`ï¼‰ã€‚
- **æ™ºèƒ½è°ƒç”¨**: 
  - ä½¿ç”¨ `list_music_styles` å·¥å…·æŸ¥è¯¢å¯ç”¨é£æ ¼ã€‚
  - åœ¨ `render_video` æ—¶ä¼ å…¥ `{ bgMusic: { style: "Tech" } }`ã€‚
  - ç³»ç»Ÿä¼šè‡ªåŠ¨ä¸‹è½½ã€ç¼“å­˜ã€è®¡ç®—æ—¶é•¿å¹¶å¾ªç¯æ’­æ”¾ã€‚
- **æ™ºèƒ½æ··éŸ³**: èƒŒæ™¯éŸ³ä¹ (0.3) ä¼šä¸ TTS è¯­éŸ³ (1.0) è‡ªåŠ¨æ··éŸ³ï¼Œ**äº’ä¸å†²çª**ã€‚
- **é…ç½®**: åœ¨ `.env` ä¸­è®¾ç½® `WEBDAV_URL`, `WEBDAV_USERNAME`, `WEBDAV_PASSWORD`ã€‚

### 8. ç¤ºä¾‹è„šæœ¬
æ–°å¢ç¤ºä¾‹è„šæœ¬ï¼Œå±•ç¤ºå¦‚ä½•ç”Ÿæˆä¸åŒé£æ ¼çš„è§†é¢‘ï¼š
- `generate_cool_cn.ts`: å±•ç¤ºå¦‚ä½•ç»„åˆ CyberIntro, SmartExplainer, PhysicsStack ç­‰é«˜çº§ç»„ä»¶ç”Ÿæˆé…·ç‚«ä¸­æ–‡è§†é¢‘ã€‚
- `generate_study_video.ts`: **(New)** å±•ç¤ºå¦‚ä½•ä½¿ç”¨ **Coze AI é…å›¾** ç”Ÿæˆæƒ…æ„Ÿç±»çŸ­è§†é¢‘ ("ä¸ºä»€ä¹ˆè¦åŠªåŠ›è¯»ä¹¦")ï¼ŒåŒ…å«è‡ªåŠ¨é…éŸ³å’Œæ™ºèƒ½å­—å¹•ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¸å¯åŠ¨

æ¨èä½¿ç”¨ [Bun](https://bun.sh/) ä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚

```bash
# å®‰è£…ä¾èµ–
bun install

# å¤åˆ¶ç¯å¢ƒå˜é‡
cp .env.example .env

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨ (é»˜è®¤ç«¯å£ 3006)
# æ³¨æ„ï¼šä¸ºäº†è®© n8n/MCP èƒ½å¤Ÿè¿æ¥ï¼Œè¯·ç¡®ä¿ AUTH_REQUIRED è®¾ç½®æ­£ç¡®
bun run dev
```

### 2. éªŒè¯æœåŠ¡

è®¿é—® `http://localhost:3006/renders` ç¡®è®¤æœåŠ¡è¿è¡Œæ­£å¸¸ã€‚
æˆ–è€…ä½¿ç”¨ curl æµ‹è¯•å¥åº·çŠ¶æ€ï¼š
```bash
curl http://localhost:3006/api/health
```

### 3. è¿è¡Œç¤ºä¾‹

ç”Ÿæˆä¸€ä¸ªé…·ç‚«çš„ n8n ä¸­æ–‡è®²è§£è§†é¢‘ï¼š

```bash
npx tsx generate_cool_cn.ts
```

---

## ğŸ¤– MCP é›†æˆæŒ‡å— (AI Agent & n8n)

æœ¬æœåŠ¡æä¾› MCP (SSE) æ¥å£ï¼Œå®Œç¾æ”¯æŒ **n8n (LangChain)**ã€**Cursor**ã€**Claude Desktop** ç­‰ AI å®¢æˆ·ç«¯ã€‚

### n8n é›†æˆä¼˜åŠ¿
- **å…¨è‡ªåŠ¨ç´ æ**: åªéœ€è¦ç»™æ–‡æ¡ˆï¼ŒRemotion ä¼šè‡ªåŠ¨æ‰¾å›¾ã€é…éŸ³ã€å‰ªè¾‘ã€‚
- **æ°¸ä¸å¤±è´¥**: å³ä½¿ç½‘ç»œæ³¢åŠ¨å¯¼è‡´ç´ æç¼ºå¤±ï¼Œä¹Ÿèƒ½ç”Ÿæˆçº¯æ–‡å­—è§†é¢‘ã€‚
- **AI ç»˜å›¾**: è®© n8n è°ƒç”¨æ™ºè°± AI ä¸ºè§†é¢‘ç”Ÿæˆç‹¬ä¸€æ— äºŒçš„é…å›¾ã€‚

### è¿æ¥é…ç½®

**SSE ç«¯ç‚¹**: `http://localhost:3006/mcp/sse`

**é…ç½®æ–‡ä»¶ç¤ºä¾‹ (Claude Desktop):**

```json
{
  "mcpServers": {
    "remotion-video": {
      "url": "http://localhost:3006/mcp/sse?token=YOUR_VIP_TOKEN_HERE"
    }
  }
}
```

> **æ³¨æ„**: å¦‚æœæ‚¨åœ¨ `.env` ä¸­å¼€å¯äº† `AUTH_REQUIRED=true`ï¼Œå¿…é¡»å°†æ‚¨çš„ Token æ‹¼æ¥åˆ° URL çš„æŸ¥è¯¢å‚æ•°ä¸­ (`?token=...`)ã€‚å¦åˆ™è¿æ¥ä¼šè¢«æ‹’ç»ã€‚

> **é”™è¯¯ç¤ºèŒƒ (è¯·å‹¿æ¨¡ä»¿)**: ä¸è¦åŒæ—¶é…ç½® `command` (node) å’Œ `url`ã€‚æœ¬æœåŠ¡ä½œä¸ºç‹¬ç«‹æœåŠ¡å™¨è¿è¡Œï¼Œä¸éœ€è¦ MCP å®¢æˆ·ç«¯æ¥å¯åŠ¨å®ƒã€‚

---

## ğŸ’¡ AI è‡ªåŠ¨åŒ–å·¥ä½œæµ (n8n / LLM)

è¦ç”Ÿæˆé«˜è´¨é‡è§†é¢‘ï¼Œå»ºè®®é‡‡ç”¨ **"ç¼–å‰§ -> å¯¼æ¼” -> æ¸²æŸ“"** çš„å·¥ä½œæµã€‚

### 1. è·å– Schema
é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `schema_export.json` åŒ…å«äº†æ‰€æœ‰å¯ç”¨ç»„ä»¶çš„å®šä¹‰ã€‚å°†å…¶å†…å®¹ä½œä¸º "System Prompt" çš„ä¸€éƒ¨åˆ†æä¾›ç»™ LLMã€‚

### 2. ä½¿ç”¨ SmartExplainer (æ™ºèƒ½æ¼”ç¤º)
è¿™æ˜¯æœ€å¼ºå¤§çš„é€šç”¨ç»„ä»¶ï¼ŒLLM åªéœ€å†³å®š "è®²ä»€ä¹ˆ" å’Œ "æ€ä¹ˆè®² (ç‰ˆå¼)"ã€‚

**æ”¯æŒçš„ Layouts:**
- **`Title`**: ç« èŠ‚å°é¢ï¼Œå¤§æ ‡é¢˜+å‰¯æ ‡é¢˜ã€‚
- **`BulletList`**: çŸ¥è¯†ç‚¹åˆ—ä¸¾ï¼Œé€æ¡æ˜¾ç¤ºã€‚
- **`Quote`**: é‡‘å¥å¼•ç”¨ï¼Œå¼ºè°ƒæ ¸å¿ƒè§‚ç‚¹ã€‚
- **`SplitImage`**: å·¦æ–‡å³å›¾ï¼Œé€‚åˆæ¡ˆä¾‹å±•ç¤ºã€‚
- **`BigStat`**: å·¨å¤§æ•°å­—ï¼Œå¼ºè°ƒæ•°æ®ã€‚

**LLM ç”Ÿæˆç¤ºä¾‹ (JSON):**
```json
{
  "type": "SmartExplainer",
  "durationInFrames": 150,
  "props": {
    "layout": "BulletList",
    "title": "Remotion çš„ä¼˜åŠ¿",
    "points": ["åŸºäº React", "è§†é¢‘å³ä»£ç ", "å®Œå…¨å¯ç¼–ç¨‹"],
    "theme": "Navy",
    "accentColor": "#60a5fa"
  }
}
```

### 3. ä½¿ç”¨ 3D & ç‰¹æ•ˆç»„ä»¶
- **`ProductShowcase3D`**: 3D ç›’å­å±•ç¤ºï¼Œæ”¯æŒç¯å¢ƒå…‰ç…§å’Œæ—‹è½¬ (æ— éœ€å¤–éƒ¨ç½‘ç»œ)ã€‚
- **`ThreeDText`**: æ‚¬æµ®çš„ 3D æ–‡å­— (å†…ç½®å…‰ç…§ï¼Œæ— éœ€å¤–éƒ¨ HDR)ã€‚
- **`PhysicsStack`**: ç‰©ä½“å—é‡åŠ›æ‰è½å †å  (åŸºäº Matter.js)ã€‚
- **`ParticleFlow`**: ç‚«é…·çš„ç²’å­æµåŠ¨èƒŒæ™¯ (åŸºäº Simplex Noise)ã€‚
- **`CyberIntro`**: èµ›åšæœ‹å…‹é£æ ¼æ•…éšœè‰ºæœ¯å¼€åœºã€‚
- **`TechCode`**: åŠ¨æ€ä»£ç è¾“å…¥å±•ç¤ºã€‚

---

## ğŸ¬ å¯ç”¨æ¨¡ç‰ˆ (MasterSequence)

æ¨èå§‹ç»ˆä½¿ç”¨ `MasterSequence` æ¨¡ç‰ˆï¼Œé€šè¿‡ `scenes` æ•°ç»„ç»„åˆä¸åŒåœºæ™¯ã€‚

| åœºæ™¯ç±»å‹ (Type) | æè¿° | æ ¸å¿ƒå‚æ•° |
|:---|:---|:---|
| **SmartExplainer** | **[æ¨è]** æ™ºèƒ½æ’ç‰ˆæ¼”ç¤º | `layout`, `title`, `points`, `theme`, `voice` |
| **CyberIntro** | **[NEW]** èµ›åšé£æ ¼å¼€åœº | `title`, `subtitle` |
| **PhysicsStack** | **[NEW]** ç‰©ç†æ‰è½æ•ˆæœ | `items` (æ•°ç»„), `voice` |
| **TechCode** | **[NEW]** ä»£ç æ¼”ç¤º | `code`, `language`, `theme` |
| **ThreeDText** | **[NEW]** 3D åŠ¨æ€æ–‡å­— | `text`, `size` |
| **ProductShowcase3D** | **[NEW]** 3D äº§å“å±•ç¤º | `productColor`, `boxSize` |
| **ParticleFlow** | ç²’å­æµåœº | `primaryColor`, `speed` |
| **IntroTitle** | ç®€çº¦æ ‡é¢˜ | `title`, `subtitle` |
| **KnowledgeCard** | çŸ¥è¯†å¡ç‰‡ | `title`, `points`, `imageUrl` |

---

## ğŸ”Œ API å‚è€ƒ

### æäº¤æ¸²æŸ“ä»»åŠ¡
`POST /renders`

**Body (åŸºç¡€ç¤ºä¾‹):**
```json
{
  "compositionId": "MasterSequence",
  "width": 1080,      // [å¯é€‰] è§†é¢‘å®½åº¦ï¼Œé»˜è®¤ 1920
  "height": 1920,     // [å¯é€‰] è§†é¢‘é«˜åº¦ï¼Œé»˜è®¤ 1080
  "inputProps": {
    "subtitleSettings": {
        "variant": "neon" // [å¯é€‰] å­—å¹•é£æ ¼: default | clean | neon | comic
    },
    "scenes": [
      {
        "type": "SmartExplainer",
        "durationInFrames": 120,
        "props": { "layout": "Title", "title": "Hello World" }
      }
    ]
  }
}
```

### æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
`GET /renders/:jobId`

---

## ğŸ› ï¸ ç»´æŠ¤ä¸æ¸…ç†

- æ¸²æŸ“äº§ç‰©é»˜è®¤ä¿ç•™ 1 å°æ—¶ã€‚
- ä½¿ç”¨ `npm run clean` æ‰‹åŠ¨æ¸…ç† `renders/` ç›®å½•ã€‚
- 3D ç»„ä»¶å·²ä¼˜åŒ–ä¸º**ç¦»çº¿å¯ç”¨**ï¼Œä¸å†ä¾èµ–å¤–éƒ¨ HDR è´´å›¾ä¸‹è½½ï¼Œé€‚åˆå†…ç½‘æˆ–å—é™ç½‘ç»œç¯å¢ƒéƒ¨ç½²ã€‚

## ğŸ“„ è®¸å¯è¯
Private.
